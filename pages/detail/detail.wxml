<!--pages/movies/detail/detail.wxml-->
<import src="/template/stars/stars.wxml" />

<wxs module="format">
  var joinSeparator = function(arr, separator) {
    return arr.join(separator);
  }
  
  module.exports.joinSeparator = joinSeparator;
</wxs>

 <view class="movie-detail">
  <view class="movie-detail-hd" style="background-image: url({{subject.images.small}})">
     <image class='poster' src="{{subject.images.small}}"></image>
  </view>
  <view class="movie-bd">
    <view class="desc">
      <view class="info">
        <view class="title">{{subject.title}}</view>
        <view class="meta">
          <view wx:if="{{subject}}">
            {{subject.year}} / 
            {{ format.joinSeparator(subject.countries, ' / ')}} /
            {{ format.joinSeparator(subject.genres, ' / ')}}
          </view>
          <view>原名: {{subject.original_title}}</view>
          <view>上映时间: {{subject.mainland_pubdate}}(中国大陆)</view>
          <view>片长: {{subject.durations[0]}}</view>
        </view>
      </view>

      <view class="rating">
        豆瓣评分
        <view class="rating-average">{{subject.rating.average}}</view>
        <block wx:if="{{subject.rating.stars}}">
          <template is="stars" data="{{ stars: subject.rating.stars }}" />
        </block>
        <view>{{subject.ratings_count}}人</view>
      </view>
    </view>

    <view class="summary" >
      <view class="tip">剧情简介</view>
      <view class="content" catchtap="onSpread">
        <view wx:if="{{isSpread}}">
          {{subject.summary}}
        </view>
        <view class="spread" wx:else>
          {{clipSummary}}
        </view>
      </view>
    </view>

    <view class="cats">
      <view class="tip">影人</view>
      <scroll-view scroll-x>
        <view class="card-wrap">
          <movie-card
            class="card"
            wx:for="{{subject.casts}}" 
            wx:key="{{item.id}}"
            mid="{{item.id}}"
            image="{{item.avatars.small}}"
            title="{{item.name}}"
            catchMovieTap="onCatsTap"
          >
          </movie-card>
        </view>
      </scroll-view>
    </view>

    <view class="photos">
      <view class="tip">剧照</view>
        <scroll-view scroll-x>
          <view class="card-wrap">
            <movie-card
              class="card photo"
              wx:for="{{subject.photos}}" 
              wx:key="{{item.id}}"
              mid="{{item.id}}"
              image="{{item.image}}"
              catchMovieTap="onPhotosTap"
            >
            </movie-card>
          </view>
        </scroll-view>
    </view>
  </view>
</view> 